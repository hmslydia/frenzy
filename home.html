<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Twitify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->   
    <link href="http://abstract.cs.washington.edu/~hmslydia/utils/bootstrap/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 40px;
        padding-bottom: 40px;
      }
    </style>
    <link href="http://abstract.cs.washington.edu/~hmslydia/utils/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/themes/black-tie/jquery-ui.css" rel="stylesheet">

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script type = "text/javascript" src="http://abstract.cs.washington.edu/~hmslydia/coda/helpers/utils.js"></script>
<script type = "text/javascript" src="http://abstract.cs.washington.edu/~hmslydia/coda/helpers/json2.js"></script>

<script type = "text/javascript" src="utils.js"></script>
<script type = "text/javascript" src="textSearch.js"></script>
<script type = "text/javascript" src="twitterFeed.js"></script>
<script type = "text/javascript" src="hashtagSummary.js"></script>
<script type = "text/javascript" src="editTweets.js"></script>
<script type = "text/javascript" src="goals.js"></script>

<style type="text/css">

body {
	background-image: url('http://homes.cs.washington.edu/~felicia0/images/twitify/spring.jpg');
	background-repeat:no-repeat;
	background-attachment: fixed;
	background-size: 100%;
	background-size: cover;
	width:100%;
	margin:0 auto;
	min-height: 100%;
	min-width: 1000px;
	overflow: visible;

}

#container{
    background: rgba(105, 105, 105, 0.5);
    
}

label{
	color:white; 
}
 
.basetweet{
    padding:5px;
    margin: 5px;
    background-color: white;
    border-radius: 6px;
}

.tweet{
    padding:5px;
    margin: 5px;
    background-color: white;
    opacity: 1.0;
   
}
.replyTextArea{
	/*width: 390px;*/
	width:86%;
	height: 70px;
	margin-left: 10px;
	margin-top: 10px;
}
.replyTextDiv{
	margin-top:15px;
	/*border-top-style:solid;
	border-top-color:blue;
	border-top-width: 1px;*/
	
	/*border: 1px solid blue;*/
	padding-bottom: 5px;
    border-radius: 6px;
    margin-left: 0;
}

.subReplyTextArea{
	border: 1px solid blue;
	/*padding-bottom: 20px;*/
	margin-bottom: 8px;
    border-radius: 6px;
}

.discussionFeed{
	margin-top: 5px;
	margin-bottom: 10px;
    margin-left:0px;
    
    border-radius: 6px;
}

.replyButton{
	margin-left: 10px;
}

.hashtag{
    color: blue;
    cursor: pointer;
}
.userNameSpan{
	color:green;
	font-size: medium;
}
.user{
    color: blue;
    cursor: pointer;
    font-face: bold;
}
#logo_img{
	display: inline-block;
	float:left;
}
#home_img{
	display: inline-block;
	float: left;
}
#discussionDiv{
	position: relative;
}

#goalSummaryContainer{
    padding:5px;
    margin: 5px;
    background-color: white;
    border-radius: 6px;
}
#hashtagSummaryContainer{
    padding:5px;
    margin: 5px;
    background-color: white;
    border-radius: 6px;
    overflow-y: scroll;
    min-height: 200px;
    
}


.hash {
  width: 150px;
  background-color: lightgreen;
  min-height: 146px;
  padding-left: 10px;
  border-radius: 6px;
}

.hash p {
  padding-top: 30px;
}

.hashInput {
  width: 120px;
}

.pastTags {
  padding-top:10px;
}

/*
#completenessEvaluation{
	padding-top: 5px;
    background-color: white;
    border-radius: 6px;
    margin-bottom: 10px;
}
#feedDiv{
	padding-top: 5px;
    background-color: white;
    border-radius: 6px;
    margin-bottom: 10px;
}*/
#composeTweetContainer{
    padding:5px;
    margin: 5px;
    
    background-color: white;
    border-radius: 6px;
}

.highlight{
    font-face: bold;
}
.sidebar-nav-fixed {
     position:fixed;
     /*overflow-y: scroll;*/
}

#newTweetCounter{
	border:2px solid;
	border-radius:25px;
	box-shadow: 10px 10px 5px #888888;
	text-align: center;
	display:block;
	color: blue;
    cursor: pointer;
    font-face: bold; 
    background-color: red;
}
#newTweetCounterTop{
	border:2px solid;
	border-radius:25px;
	text-align: center;
	color: black;
    cursor: pointer;
    font-face: bold; 
    background-color: grey;
    width: 100%;
}

.homeButton{
	clear:both;
	left:-40px;
}
#counter{
	left:75px;
	color: white;
}
.homeImage { 
   position: relative; 
   width: 100%; /* for IE 6 */
}

.paddingTop{
	padding-top: 20px;
}

h2 { 
   position: absolute; 
   top: -12px; 
   left: 40px; 
   width: 100%; 
   font-size:medium;
   font-style: bold;
}

#chatBox {
   position: fixed;
   bottom: 0px;
   right: 10px;
   width: 200px;
   height: 150px;
   border: 1px solid black;
   background-color: white;
}

#chatLog {
   height: 57%;
   overflow: auto;
   overflow-y: scroll;
   padding: .2em;
   width: 100%;
}

#chatLog p {
  margin-top: .2em;
  margin-bottom: .2em;
}

#chatEnterArea {
   padding: .2em;
   height: 22%;
   border: 1px solid blue;
   overflow: auto;
   border-radius: 0;
   -webkit-border-radius: 0;
   width: 96.5%;
}

#chatBox button {
  width: 24%;
  margin-top: .5em;
  /*position: relative;*/
  float: right;
  /*top: -54px;*/
}

#chatTitleBar {
  background-color: #009933;
  color: white;
}

#chatTitleBar span {
  float: right;
  padding-right: .3em;
  padding-left: .3em;
  font-weight: bold;
  font-size: larger;
  cursor: pointer;
}

#chatBox.hideChat {
  bottom: -130px !important;
}

.button{
	height:40px;
}
.newDiscussion{
	background-color: pink;
}
.newDiscussion2{
	background-color: yellow;
}
.newLike{
	font-weight: bold;
	color:pink;
}
.beingEdited{
    border: 5px solid blue;
}

/*
Styles for the goals/requiresment (each item needs at least one hashtag)
*/
#matchingRequirmentsButton{
    margin-right: 20px;
}
#completenessFeedback{
    display: inline-block;
    margin-left: 425px;
}
    
#signOut{
    margin-left: 10px;
}

</style>



<script type="text/javascript">
var chatShowing = true;
var twitterFeed = []

function getUserName(){
	return $("#username").val()
}

function ajax(command, result, cb) {    
    //console.log("ajax command: "+command);
    //console.log(result)
  result["username"] = getUserName()
	$.post(document.location.href, { "command" : command, args : JSON.stringify(result) }, cb)
}
























var fromLanguage = "fr";
var toLanguage = "en";
var isEnabled = true;

var currentTranslation = {};
var clickedHashtag =null;

function setup(){

 document.addEventListener("contextmenu", logSelection,false);
 document.addEventListener("click", logSelectionLeft,false);
}

function logSelectionLeft(e){
	console.log("id",e.target['id'].indexOf('editbox'));
	console.log("e.which",e.which);
	if(e.which ==1 && e.target['id'].indexOf('editbox')==-1){
		console.log("logging selections");
		HideContent('uniquename3')
	}
	console.log("log",$(".moveTo")!=null);
	if(e.which ==1 && $(".moveTo")!=null){
	var word = getWordAtPoint(e.target, e.x, e.y);

		$('.moveTo').val(word)
	}
}
//On a mouse click, log the word that's clicked if the toggle is on
function logSelection(e) {
  
 // if(isEnabled) {
    var word = getWordAtPoint(e.target, e.x, e.y);
    if(word != null) {
    	e.preventDefault();
    	console.log("CLICKED WORD",word);
    	
    	var d = e.target;
    	console.log(d.className)
    	
    	if(d.className == 'hashtag'){
    		clickedHashtag = d;
    		console.log(clickedHashtag);
	    	while (d != null && d['id'] != 'hashtagSummary') {
	    		console.log(d['id']);
	    		d = d.parentNode;
		    }
		
		    // at this point we have found our containing div or we are out of parent nodes
		    var insideMyDiv = (d != null && d['id'] == 'hashtagSummary');
	    	
	    	if(insideMyDiv){
		    	console.log("INSIDE MY DIV");
		    	ShowContent('uniquename3')
	    	}
	    	else{
	    		HideContent('uniquename3')
	    	}
	    }
    }
    else{
    	console.log("hide");
    	HideContent('uniquename3')
   	}
  return false;
}



// Recursively search for the word under the current cursor 
//  Adapted from: http://stackoverflow.com/a/3710561
function getWordAtPoint(elem, x, y) {
    if (elem.nodeType == elem.TEXT_NODE) {
        var range = elem.ownerDocument.createRange();
        range.selectNodeContents(elem);
        var currentPos = 0;
        var endPos = range.endOffset;
        while (currentPos + 1 < endPos) {
            range.setStart(elem, currentPos);
            range.setEnd(elem, currentPos + 1);
            if (range.getBoundingClientRect().left <= x && range.getBoundingClientRect().right >= x && range.getBoundingClientRect().top <= y && range.getBoundingClientRect().bottom >= y) {
                range.expand("word");
                var ret = range.toString();
                range.detach();
                return (ret);
            }
            currentPos += 1;
        }
    } else {
        for (var i = 0; i < elem.childNodes.length; i++) {
            var range = elem.childNodes[i].ownerDocument.createRange();
            range.selectNodeContents(elem.childNodes[i]);
            if (range.getBoundingClientRect().left <= x && range.getBoundingClientRect().right >= x && range.getBoundingClientRect().top <= y && range.getBoundingClientRect().bottom >= y) {
                range.detach();
                return (getWordAtPoint(elem.childNodes[i], x, y));
            } else {
                range.detach();
            }
        }
    }
    return (null);
}



//Get the x and y screen coordinates of the selected text
// Adapted from: http://stackoverflow.com/a/6847328
function getSelectionCoords() {
  var sel = window.getSelection();
  var x = 0, y = 0;
  if(sel) {
    if (sel.rangeCount) {
        range = sel.getRangeAt(0).cloneRange();
        if (range.getClientRects) {
            var rect = range.getBoundingClientRect();
            x = rect.left;
            y = rect.top + $(document).scrollTop();
        }
    }
  }
  return { x: x, y: y };
}

$(document).ready(setup);

var cX = 0; var cY = 0; var rX = 0; var rY = 0;
function UpdateCursorPosition(e){ cX = e.pageX; cY = e.pageY;}
function UpdateCursorPositionDocAll(e){ cX = event.clientX; cY = event.clientY;}
if(document.all) { document.onmousemove = UpdateCursorPositionDocAll; }
else { document.onmousemove = UpdateCursorPosition; }
function AssignPosition(d) {
	if(self.pageYOffset) {
		rX = self.pageXOffset;
		rY = self.pageYOffset;
		}
	else if(document.documentElement && document.documentElement.scrollTop) {
		rX = document.documentElement.scrollLeft;
		rY = document.documentElement.scrollTop;
		}
	else if(document.body) {
		rX = document.body.scrollLeft;
		rY = document.body.scrollTop;
		}
	if(document.all) {
		cX += rX; 
		cY += rY;
		}
	d.style.left = (cX ) + "px";
	d.style.top = (cY ) + "px";
}

function HideContent(d) {
	if(d.length < 1) { return; }
	document.getElementById(d).style.display = "none";
}


function ShowContent(d) {
	if(d.length < 1) { return; }
	var dd = document.getElementById(d);
	AssignPosition(dd);
	dd.style.display = "block";
}

function ReverseContentDisplay(d) {
	if(d.length < 1) { return; }
	var dd = document.getElementById(d);
	AssignPosition(dd);
	if(dd.style.display == "none") { dd.style.display = "block"; }
	else { dd.style.display = "none"; }
}













function signIn(){
	username=getUserName();

	if($("#signInOut").val() == "Sign In" && username!=""){
	
		$("#signInOut").val("Sign Out")
		
		//document.getElementById('username').readOnly=true;
		
		displayComposeTweet(username)
		
		ajax("SignIn",{"username":username},function(returnData) {
		});
		
		$("#username").hide();
		$("#signInOut").hide();
		goToHome()
	}
}
function signOut(){
		$("#signInOut").val("Sign In")
		$("#composeTweet").empty();
		$("#username").show();
		$("#signInOut").show();
}

function goToHome(){
	twitterFeedSetup();
	$("#homeButton").attr('src','http://homes.cs.washington.edu/~felicia0/images/twitify/homebutton.png');
	$("#counter").text("");
}

window.onresize=function(event){
	
		//var chatboxHeight = $("#chatBox").height()
		
		var topLeft = $("#hashtagSummaryContainer").position().top +40;
		console.log("TOPLEFT "+topLeft);
		var margin = 30;
        var h = window.innerHeight - topLeft - margin;

        
        $("#hashtagSummaryContainer").css("max-height",h + "px");
        
};

$(document).ready(function(){

	
    
    goalSetup()
    twitterFeedSetup()
	textSearchSetup()
    
    $("#saveDiscussion").click(function() {
		storeOldData();  
		fetchNewJokeForFeed()
	})
    
    $("#signInOut").click(function(){
        signIn()
    })
    $("#username").keypress(function(event) {
        if( event.which == 13 ) {
            signIn()
       }
    })

    //set up chat
    $("#chatTitleBar span").click(showHideChat);



/*    $("#sendChat").click(function(event) {
       sendChat();
    });*/

    $("#chatEnterArea").keypress(function(event) {
      if(event.which == 13 && !event.shiftKey) {
        // Shift key to add new line
           event.preventDefault();
           sendChat();
       }
    })

   // Load up initial chat log
	getChatConversation() 
    window.onresize();  
})

function sendChat() {
    var phrase = $("#chatEnterArea").val();
    $("#chatEnterArea").val("");
    clearInterval(timer);
    timer = null;
    pushChatConversation(phrase);
}

function showHideChat() {
  if(chatShowing) {
    chatShowing = false;
    $("#chatBox").addClass("hideChat");
  } else {
    chatShowing = true;
    $("#chatBox").removeClass("hideChat");
  }
}

function getCompletionConditionHashtags(){
    //var requirementString = $("#requirements").val()
    //return requirementString;
    
    return "#"
}

//////////////////////////////////////////
// visualizing other editor helpers
//////////////////////////////////////////
var userLocationUpdateTimer = setInterval(function(){updateUserLocations()}, 5000);

function updateUserLocations(){
    ajax("getLocations", {}, function(returnData) {

       var locations = JSON.parse(returnData)["locations"];
//console.log(locations)
       var username = getUserName()
       var idsInUse = filterArray(locations, function(x){return x["user"] != username})
       var idsInUse = map(idsInUse, function(x){return x["id"]})       
       highlightBaseTweets(idsInUse)
   });   
}

function highlightBaseTweets(listOfBasetweetIdsToHighlight){
//console.log("highlight")
//console.log(listOfBasetweetIdsToHighlight)
    //remove all highlights
    $(".basetweet").each(function( index){
        $(this).removeClass("beingEdited")
    });
    
    //highlight the ones we being discussed
    for(i in listOfBasetweetIdsToHighlight){
        var idToHightlight = listOfBasetweetIdsToHighlight[i]
 
        $("#"+idToHightlight).addClass("beingEdited")

    }    
}

//////////////////////////////////////////
// chat helpers
//////////////////////////////////////////
var timer = setInterval(function(){getChatConversation()}, 1000);

function getChatConversation() {
   ajax("getComments", {}, function(returnData) {
       var commentsObject = JSON.parse(returnData)["conversation"];

       updateChatConversation(commentsObject);
   });
}

function pushChatConversation(newChatText) {
   ajax("pushComments", {"comment":newChatText}, function(returnData) {
      var commentsObject = JSON.parse(returnData)["conversation"];

      updateChatConversation(commentsObject);
   });
}

function updateChatConversation(commentsArray) {
   //$("#chatLog").html("");
    for(var i = 0; i < commentsArray.length; i++) {
        var p = $("<p>");
        if(commentsArray[i]["user"] == "") {
        commentsArray[i]["user"] = "Guest";
        }
        var userComment = "<b>" + commentsArray[i]["user"] + "</b>: " + commentsArray[i]["comment"];
        p.html(userComment);
        $("#chatLog").append(p);
    }
    if(commentsArray.length > 0) {
      $("#chatLog").animate({ scrollTop: $("#chatLog").attr("scrollHeight") }, 0); 
    }
    if(!timer) {
        timer = setInterval(function(){getChatConversation()}, 5000);
    }
}

//////////////////////////////////////////
// completion update helpers
//////////////////////////////////////////
var int=self.setInterval(function(){checkForUpdates()},1000);

function checkForUpdates(){
	ajax("getUpdates",{"completionConditionHashtags": getCompletionConditionHashtags()}, function(returnData) {
		var count = JSON.parse(returnData)["newTweetCount"]
		var newTweetCreators = JSON.parse(returnData)["newTweetCreators"]
		
		
        colorNewTweetsInTheFeedAndUpdateNewTweetCount(newTweetCreators);
        
        var completionDataObjects = JSON.parse(returnData)["completionDataObjects"]
        var likes = JSON.parse(returnData)["likes"]
		displayCompletionData(completionDataObjects,likes)
        
        }
    )
}

function displayCompletionData(completionDataObjects,likes){
	var matchingBaseTweetObjects = completionDataObjects["matchingBaseTweetObjects"]
	var nonMatchingBaseTweetObjects = completionDataObjects["nonMatchingBaseTweetObjects"]

	displayConditionsUpdate(matchingBaseTweetObjects, nonMatchingBaseTweetObjects,likes)
}

function updateNewTweetCount(count){
	if(count>0){
		$("#countPlaceholder").empty();
		
		leftCounterDiv = $("<div id='newTweetCounter'>");
		leftCounterDiv.text(count);
		
		
		leftCounterDiv.click(function(){
			goToHome();
			$("#countPlaceholder").empty();
		});

		//$("#countPlaceholder").append(leftCounterDiv);
		
		$("#homeButton").attr('src','http://homes.cs.washington.edu/~felicia0/images/twitify/homebuttonNewMessages5.png');
		$("#counter").text(count);
	}
	else{
		$("#countPlaceholder").empty();
		$("#homeButton").attr('src','http://homes.cs.washington.edu/~felicia0/images/twitify/homebutton.png');
		$("#counter").text("");
	}
}


function outputHierarchy(){
	ajax("getTwitterFeed", {}, function(returnData) {
		createOutput(JSON.parse(returnData)["hashtagSummary"],JSON.parse(returnData)["twitterFeed"])
	});
}



function createOutput (hashtagSummary,twitterFeed) {

  var userName = getUserName()
  var newPage = "<html><head><title>"
  newPage += userName;
  newPage += "</title></head><body>";
  newPage += "<p>Output " + userName;
  newPage += "</p></body></html>";

  newPage+=outputHashtagSummary(hashtagSummary,twitterFeed)
  
  var j = window.open();
  j.document.write(newPage);
  //j.document.close();
}


function outputHashtagSummary(hashtagSummary,twitterFeed){
	var tweetIdsWithHashTags=[]
   	var baseTweets = filterArray(twitterFeed, function(tweetObj){ return tweetObj["basetweet"]["parent"]=="none" })
   	var baseTweetIds = map(baseTweets, function(x){return x["basetweet"]["id"]})

    var newPageDiv=$("<div id='newPageDiv'>")
    
    answer = []
    var allHashtags = []
    for( i in hashtagSummary){
        var hashtagObject = hashtagSummary[i]
        allHashtags.push({"hashtag":hashtagObject, "parents":[]} )
    }
    orderAndEnchild(allHashtags, allHashtags)

    for(i in answer){
        var hashtagSummaryItem = answer[i]
        var hashtag = hashtagSummaryItem["hashtag"]["hashtag"]
        var memberTweetIds = hashtagSummaryItem["hashtag"]["memberTweetIds"]
        var indents = hashtagSummaryItem["parents"].length
        var counts = hashtagSummaryItem["hashtag"]["counts"]
        
        tweetIdsWithHashTags.push.apply(tweetIdsWithHashTags,memberTweetIds)

        var ul=$("<ul>")
        ul.css('list-style-type','none');
        hashtagDiv = createHashtagli(hashtag, counts)

        var images = getImagesInHashtagAsHtml(hashtag,indents,hashtagSummary,twitterFeed,hashtagDiv);
        ul.append(images)
        
        newPageDiv.append(ul);
    }  
    
    //remove duplicates
    tweetIdsWithHashTags=tweetIdsWithHashTags.filter(function(item, index) {
            return tweetIdsWithHashTags.indexOf(item) == index;
    });
    
    var uncategorizedTweetIds = baseTweetIds.filter(function(i) {return !(tweetIdsWithHashTags.indexOf(i) > -1);});
  
    var ul=$("<ul>")
    var li =$("<li>")
    li.text("Uncategorized");
    ul.append(li);
    ul.css('list-style-type','none');
    ul.css('margin-left',"30px")
    for(uncat in uncategorizedTweetIds){
	    tweetId = uncategorizedTweetIds[uncat]

	    var imageHtml=$("<li>");
	    var html = filterArray(twitterFeed, function(x){return x["basetweet"]["id"]==tweetId})[0]["basetweet"]["html"]
	  
	    imageHtml.css('width',"200px")
	    imageHtml.css('display','inline-block')
        imageHtml.append(html)
        ul.append(imageHtml);
    }
    newPageDiv.append(ul);

   return newPageDiv.html();
}


function getImagesInHashtagAsHtml(hashtag,indent, hashtagSummary,twitterFeed,hashtagDiv){
	var imageHtml=$("<li>");
	var tweetIds = getListOfTweetIdsForHashtag(hashtagSummary,hashtag);
	var filteredTweets = filterArray(twitterFeed, function(x){ return tweetIds.indexOf(x["basetweet"]["id"])>-1})

	var imagesDivUL=$("<ul>")
	imagesDivUL.css('list-style-type','none');
	imagesDivUL.css('margin-left',indent*30+"px")
	imagesDivUL.append(hashtagDiv);
	for(t in filteredTweets){
		var tweet = filteredTweets[t]
		var tweetHtml = tweet["basetweet"]["html"]
		
		var imagesDiv=$("<li>")
		imagesDiv.css('margin-left',indent*30+"px")
		imagesDiv.css('display','inline-block')
		imagesDiv.css('width',"200px")
        imagesDiv.append(tweetHtml);
        
        imagesDivUL.append(imagesDiv)
	}
	imageHtml.append(imagesDivUL);
	return imageHtml
}

function getListOfTweetIdsForHashtag(allHashTags,hashtag){
	var filteredArray= filterArray(allHashTags, function(x){ return (x["hashtag"])==hashtag})
	var tweetIds = map(filteredArray, function(x){return x["memberTweetIds"]})
	return tweetIds[0]
}


function getListOfHashTagsForBaseTweet(baseTweetId,allHashTags){
	var hts = getHashtagSummaryForBaseTweet(baseTweetId,allHashTags)
	var hashTags = map(hts, function(x){return x["hashtag"]})
	return hashTags
}

function getHashtagSummaryForBaseTweet(baseTweetId,allHashTags){
	//{"hashtag": hashtag, "counts":counts, "memberTweetIds": baseTweets}

	var filteredArray= filterArray(allHashTags, function(x){ return (x["memberTweetIds"]).indexOf(baseTweetId)>-1})
    return filteredArray;
    
}



function createHashtagli(hashtag, counts){
    div= $("<li>")
    div.text(hashtag + " ("+counts+") ")
    return div
}



function editHashtagText(){

	var oldHashtag = clickedHashtag.innerHTML;//.substr(1);
	
	clickedHashtag.parentNode.innerHTML = "<input id = 'editbox-"+oldHashtag+"' class='editbox' type ='textbox' value='"+oldHashtag+"'>";
	
	$("input.editbox").bind("keypress", function(event) {
	console.log("IN ENTER EVENT");
        if( event.which == 13 ) {
	        var newHashtag = $(this).val();
	        
          	 console.log("enter");
             ajax("renameHashtag", {"oldHashtag":oldHashtag.toLowerCase(), "newHashtag":newHashtag.toLowerCase()}, function(returnData) {
             	var likes = JSON.parse(returnData)["likes"]
		        var twitterFeed = JSON.parse(returnData)["twitterFeed"]
		        var hashtagSummary = JSON.parse(returnData)["hashtagSummary"]
		        var newTweetCreators = JSON.parse(returnData)["newTweetCreators"]
		        var newLikeIds = JSON.parse(returnData)["newLikeIds"]
		        var requiredHashtags = JSON.parse(returnData)["requiredHashtags"]
		        var lastRefreshTime = JSON.parse(returnData)["lastRefreshTime"]
		        
		        resetTweetClickUpdateTimes(twitterFeed,lastRefreshTime);
				displayFeed(twitterFeed,likes);
				displayHashtagSummary(hashtagSummary)
				//displayComposeTweet(getUserName())
				colorNewTweets(newTweetCreators);
				colorNewLikes(newLikeIds)
				setRequiredHashtags(requiredHashtags)
	         });
       }
    })
}

function moveHashtag(){
	
	var newChildHashtag = clickedHashtag.innerHTML;
	
	clickedHashtag.parentNode.innerHTML = "Move To: <input id = 'moveTo-"+newChildHashtag+"' class='moveTo' type ='textbox' placeholder='select hashtag'>";
	
	$("input.moveTo").bind("keypress", function(event) {

        if( event.which == 13 ) {
	        var parentHashtag = $(this).val();
          	 console.log("enter");
             ajax("moveToHashtag", {"newChildHashtag":newChildHashtag.toLowerCase(), "parentHashtag":parentHashtag.toLowerCase()}, function(returnData) {
             	var likes = JSON.parse(returnData)["likes"]
		        var twitterFeed = JSON.parse(returnData)["twitterFeed"]
		        var hashtagSummary = JSON.parse(returnData)["hashtagSummary"]
		        var newTweetCreators = JSON.parse(returnData)["newTweetCreators"]
		        var newLikeIds = JSON.parse(returnData)["newLikeIds"]
		        var requiredHashtags = JSON.parse(returnData)["requiredHashtags"]
		        var lastRefreshTime = JSON.parse(returnData)["lastRefreshTime"]
		        
		        resetTweetClickUpdateTimes(twitterFeed,lastRefreshTime);
				displayFeed(twitterFeed,likes);
				displayHashtagSummary(hashtagSummary)
				//displayComposeTweet(getUserName())
				colorNewTweets(newTweetCreators);
				colorNewLikes(newLikeIds)
				setRequiredHashtags(requiredHashtags)
	         });
       }
    })
}

</script>
</head>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active">
              <div class="homeImage"><a href="#" onclick="goToHome()"><h2 id="counter"></h2><img class="homeButton" id='homeButton' src="http://homes.cs.washington.edu/~felicia0/images/twitify/homebutton.png"></a></div>
              </li>
            </ul>
            <form class="navbar-form pull-right" id="navBarForm">
                <input type="text" id="username" placeholder="username" >
                <input type="button" class="btn" id="signInOut" value= "Sign In" />
              
                <input class="span2" type="text" placeholder="search" id="search">
                <!-<input type="button" class="btn" id="searchSubmit" value= "Search" />
              
                <select class="span2" id="sortBy">
                    <option value="default">(default)</option>
                    <option value="mostDiscussed">most discussed</option>
                    <option value="mostDiscussedByMe">most discussed by me</option>
                    <option value="leastDiscussed">least discussed</option>
                    <option value="leastDiscussedByMe">least discussed by me</option>
                    <option value="original">(original order)</option>
                </select>
                
              <!-- <input class="span2" type="text" placeholder="search" id="sortBy"> -->
              <input type="button" class="btn" id="sortSubmit" value= "Search" />
            </form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    
<div id="container" class="container">
    <div class="row">
        <div class="span3" >
            <div class= "sidebar-nav-fixed">
                <div class="row">
                    <div class="span3" >
                       <div id ="composeTweetContainer" style="width:100%" >
                            <div class="column" id="composeTweet">
                                
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="span3" >
                       <div id ="goalSummaryContainer" style="width:100%" >
                            
                            <b>Goal:</b><br>
                            <div id="goalDescription">
                           
                            </div>
                            <div id="goalFeedback">
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <div class="row">
                   <div class="span3" >
                        <div id ="hashtagSummaryContainer" style="width:100%">
                            <div class="column" id="hashtagSummary">
                            
                            </div>
                       </div>
                   
                    </div>       
                </div>
            </div>
        </div>
        <div class="span9" > 
            <div class="row">                
                <div class="span9">
                    <div id ="feedDiv">
                        <div class="span9" id="twitterFeed">
                            
                        </div>        
                    </div>                            
                </div>
            </div>
        </div>
    </div>
</div>    
<div id="chatBox">
  <div id="chatTitleBar">Chat<span>_</span></div>
   <div id="chatLog">
   </div>
   <!--<button id="sendChat">Send</button> -->  
   <textarea type="text" id="chatEnterArea"></textarea>

</div>  



<div 
   id="uniquename3" 
   style="display:none; 
      position:absolute; 
      border-style: solid; 
      background-color: white; 
      padding: 5px;">
<a onclick="editHashtagText();"><div id='editable'>Rename</div></a>
<a onclick="moveHashtag();"><div id='editable'>Move To</div></a>
</div>

</body>
</html>
